<!DOCTYPE html>
<html>
<head>
    <title>Attention Head Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 2rem;
            background-color: #f0f0f0;
            color: #333;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }

        canvas {
            border: 2px solid #ccc;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            cursor: pointer;
        }

        .selector-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        label {
            font-weight: 600;
        }

        select {
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="selector-container">
            <label for="attnHeadSelector">Select Attention Head:</label>
            <select id="attnHeadSelector"></select>
        </div>
        <div style="display: flex; gap: 2rem;">
            <canvas id="viwvuctufr" width="400" height="400"></canvas>
            <canvas id="dmioulfllg" width="400" height="400"></canvas>
        </div>
    </div>

    <script>
        window.onload = function() {
            // --- Variable Definitions ---
            const CANVAS_ATTN_ID = "viwvuctufr";
            const CANVAS_IMG_ID = "dmioulfllg";
            const ATTN_HEAD_SELECTOR_ID = "attnHeadSelector";
            
            // Placeholder data - replace with your actual JSON data
            const NAMES_JSON = '["Corner Head"]';
            const IMAGE_SIZES_JSON = "[224]";
            const PATCHES_JSON = "[[[100, 100], [150, 150]]]";

            // --- DOM Element and Canvas Context Setup ---
            const canvasAttn = document.getElementById(CANVAS_ATTN_ID);
            const ctxAttn = canvasAttn.getContext('2d');
            const canvasImg = document.getElementById(CANVAS_IMG_ID);
            const ctxImg = canvasImg.getContext('2d');
            const attnHeadSelector = document.getElementById(ATTN_HEAD_SELECTOR_ID);

            // --- Visualization Parameters (placeholders) ---
            const ATTN_SCALING = 5;
            const patchSize = 16;
            const numPatchWidth = 14;
            const CLS_TOKEN = false;
            const colorTokenB = 'rgba(255, 105, 180, 0.5)'; // Hot Pink
            let lastHighlightedX = null;
            let lastHighlightedY = null;
            let patches = JSON.parse(PATCHES_JSON);
            
            // --- Functions ---
            function redrawAll() {
                // Clear and redraw the canvases. This is a placeholder.
                ctxAttn.clearRect(0, 0, canvasAttn.width, canvasAttn.height);
                ctxImg.clearRect(0, 0, canvasImg.width, canvasImg.height);
                // Draw a simple grid as a visual aid
                for (let r = 0; r < numPatchWidth; r++) {
                    for (let c = 0; c < numPatchWidth; c++) {
                        ctxAttn.fillStyle = 'rgba(200, 200, 200, 0.5)';
                        ctxAttn.fillRect(r * ATTN_SCALING, c * ATTN_SCALING, ATTN_SCALING, ATTN_SCALING);
                    }
                }
            }

            // Function to handle highlighting a specific cell
            function highlightCell(x, y) {
                if (lastHighlightedX !== x || lastHighlightedY !== y) {
                    redrawAll(); // Redraw everything to clear previous highlights

                    // Highlight based on the provided logic from the user's snippet
                    if (!(CLS_TOKEN && (y == 0))) {
                        // Placeholder for image highlighting logic.
                        ctxImg.fillStyle = colorTokenB;
                        // Example: ctxImg.fillRect(patches[0][0][1] * patchSize, patches[0][0][0] * patchSize, patchSize, patchSize);
                    } else {
                        ctxImg.fillStyle = colorTokenB;
                        for (let r = 0; r < numPatchWidth; r++) {
                            for (let c = 0; c < numPatchWidth; c++) {
                                ctxImg.fillRect(c * patchSize, r * patchSize, patchSize, patchSize);
                            }
                        }
                    }

                    // Draw white square on attn matrix
                    ctxAttn.fillStyle = 'white';
                    ctxAttn.fillRect(y * ATTN_SCALING, x * ATTN_SCALING, ATTN_SCALING, ATTN_SCALING);

                    lastHighlightedX = x;
                    lastHighlightedY = y;
                }
            }
            
            // Populate the attention head selector with placeholder options
            const names = JSON.parse(NAMES_JSON);
            names.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                attnHeadSelector.appendChild(option);
            });

            // --- Event Listeners ---
            canvasAttn.addEventListener('mousemove', function(event) {
                const rect = canvasAttn.getBoundingClientRect();
                const x = Math.floor((event.clientX - rect.left) / ATTN_SCALING);
                const y = Math.floor((event.clientY - rect.top) / ATTN_SCALING);
                
                if (x >= 0 && x < canvasAttn.width / ATTN_SCALING && y >= 0 && y < canvasAttn.height / ATTN_SCALING) {
                    highlightCell(x, y);
                }
            }, { passive: true });

            canvasAttn.addEventListener('mouseout', function() {
                redrawAll();
                lastHighlightedX = null;
                lastHighlightedY = null;
            });

            // --- Initial Drawing ---
            redrawAll();
        };
    </script>

</body>
</html>
